<page-layout>
  <div class="flex justify-center flex-1" *ngIf="!isLoading">
    <div>
      <h1 class="text-3xl text-center mb-8">Set New Password</h1>

      <div *ngIf="!success && !error">
        <p class="text-gray-600 mb-6 text-center">
          Enter your username and choose a new password for your account.
        </p>

        <form class="w-full mt-8" #form="ngForm" (ngSubmit)="resetPassword()" (keydown.enter)="resetPassword()">
          <div class="flex flex-col mb-4">
            <input-field
              name="username"
              [label]="'Username'"
              class="col-span-2"
              [className]="'w-full col-span-2'"
              [type]="InputType.text"
              [(value)]="username"
              [form]="form"
            ></input-field>
            <div class="h-5">
              <div *ngIf="submitted && !username" class="text-xs text-red-600 mt-1">
                <p>Username is required!</p>
              </div>
            </div>
          </div>

          <div class="flex flex-col mb-4">
            <input-field
              name="password"
              [label]="'New Password'"
              class="col-span-2"
              [className]="'w-full col-span-2'"
              [type]="InputType.password"
              [(value)]="password"
              [form]="form"
            ></input-field>
            <div class="h-5">
              <div class="text-xs text-red-600 mt-1 h-3">
                <p *ngIf="submitted && !password">Password is required!</p>
                <p *ngIf="submitted && password && password.length < 8">
                  Password must be at least 8 characters!
                </p>
              </div>
            </div>
          </div>

          <div class="flex flex-col mb-6">
            <input-field
              name="confirmPassword"
              [label]="'Confirm Password'"
              class="col-span-2"
              [className]="'w-full col-span-2'"
              [type]="InputType.password"
              [(value)]="confirmPassword"
              [form]="form"
            ></input-field>
            <div class="h-5">
              <div class="text-xs text-red-600 mt-1 h-3">
                <p *ngIf="submitted && !confirmPassword">Please confirm your password!</p>
                <p *ngIf="submitted && confirmPassword && password !== confirmPassword">
                  Passwords do not match!
                </p>
              </div>
            </div>
          </div>

          <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <p class="text-sm">{{ errorMessage }}</p>
          </div>

          <simple-button className="w-full py-3 mt-2 font-semibold text-white rounded-lg" (click)="resetPassword()">
            Reset Password
          </simple-button>

          <div class="flex justify-center mt-3">
            <a class="text-sm text-primary underline hover:text-primary-light" [routerLink]="['/forgot-password']">
              Request a new reset link
            </a>
          </div>
        </form>
      </div>

      <div *ngIf="error && errorMessage" class="text-center">
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
          <p class="font-bold">Password Reset Failed</p>
          <p class="text-sm mt-2">{{ errorMessage }}</p>
        </div>

        <simple-button className="w-full py-3 mt-4 font-semibold text-white rounded-lg" [routerLink]="['/forgot-password']">
          Request New Reset Link
        </simple-button>

        <div class="flex justify-center mt-3">
          <a class="text-sm text-primary underline hover:text-primary-light" [routerLink]="['/login']">
            Return to Login
          </a>
        </div>
      </div>

      <div *ngIf="success" class="text-center">
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
          <p class="font-bold">Password Reset Successful!</p>
          <p class="text-sm mt-2">
            Your password has been successfully reset. You can now log in with your new password.
          </p>
        </div>

        <simple-button className="w-full py-3 mt-4 font-semibold text-white rounded-lg" [routerLink]="['/login']">
          Go to Login
        </simple-button>
      </div>
    </div>
  </div>

  <loading-spinner [isLoading]="isLoading"></loading-spinner>
</page-layout>
